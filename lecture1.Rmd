---
title: "Data science and analysis in Neuroscience"
author: "Kevin Allen"
date: "November 7, 2019"
output:
  ioslides_presentation: default
  slidy_presentation: default
  beamer_presentation: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
```

## Today's plan
1. Overview of the course
2. Assessment of previous experience
3. Data science landscape and RStudio
4. Introduction to R
5. Introduction to ggplot2


## What is data science?

Turn raw data into understanding, insight and knowledge.


```{r, echo=FALSE,out.width = "800px"}
knitr::include_graphics("images/data-science.png")
```


## Course objectives

1. Identify the principal tools available in data science.
2. Import your data into R.
3. Visualize distributions of single variables and relations between several variables using ggplot2.
4. Transform and subset your data using tidyverse.
5. Understand what machine learning is and name its principal advantages and challenges.
6. Apply a machine-learning algorithm to test a hypothesis in neuroscience.
7. Harness the power of deep neural networks to quantify behavior with deeplabcut.

## Supporting materials

1. [R for Data Science](https://r4ds.had.co.nz/)

```{r, echo=FALSE, out.width = "100px"}
knitr::include_graphics("images/rds_cover.png")
```

2. [An Introduction to Statistical Learning: With Applications in R](https://www.academia.edu/36691506/An_Introduction_to_Statistical_Learning_Springer_Texts_in_Statistics_An_Introduction_to_Statistical_Learning). 

```{r, echo=FALSE, out.width="100px"}
knitr::include_graphics("images/isl_cover.jpeg")
```

Both books are available online.

## Conventions in the slides

Code appears as the next 3 line.
```{r ex, echo=TRUE,eval=FALSE}
x <- 10
y <- 5
x + y
```

Comments start with `#`, output starts with `##`.
```{r ex1}
# This is a comment, for humans only
x <- 10
y <- 5
x + y
```


## Course online repository

The content of the course is in a GitHub repository.

https://github.com/kevin-allen/dataNeuroCourse

We will cover [git](https://git-scm.com/) and online repositories later on.

To copy the repository to your computer:
```{bash clone,  eval=FALSE}
git clone https://github.com/kevin-allen/dataNeuroCourse
```
To update your local version, from within your local repository directory
```{bash pull, eval=FALSE}
git pull
```

## Lecture format

1. Short introduction of topics
2. Exercises in small groups
3. Review of exercises
4. Homeworks: readings or some exercises
5. Review quizzes

It is your course, interrupt me as often as you like.


## Previous experience

A short survey of the classroom.

https://tinyurl.com/y2rtpf2h


## Data science landscape
### Matlab

Stable environment, singal processing, matrix operations

Weakness: Proprietary programming language -> Implications in science

### Python
Open-source language, general-purpose, popularity rising, TensorFlow for machine learning

### R
Open-source language, statistical analysis, visualization, R packages, RStudio


## Data science landscape

Recommendation: Use open-source languages (`R` and `python`).

Both `R` and `python` are great tools for data analysis.

In the end, the most crucial point is to get the job done.

We will use mainly `R`. 

We will use `python` for our `deeplabcut` project.

## RStudio
```{r, echo=FALSE,out.width = "650px"}
knitr::include_graphics("images/rstudio-console.png")
```


## Introduction to R 

Perform simple calculation as you would expect.
```{r example1,eval=FALSE}
4 + 9
(360 + 50) / 2
```

## Variables 
Create an object to store a value using `<-`. You can display the value stored in an object by simply writing its name.

Variable names must to start with a letter and can also contain numbers and _.
```{r example2,eval=T}
x <- 10 + 50
x
print(x)
```
Trick: `<-` shortcut is Alt-- (Alt and minus sign)

## Variables

```{r, echo=FALSE,out.width = "800px"}
knitr::include_graphics("images/variable_names.png")
```

## Arithmetic operators
```{r arithmetic,echo=FALSE,eval=TRUE}
kable(data.frame(Operator=c("+", "-", "*", "/", "^", "%%", "%/%"),
                 Description=c("Addition","Subtraction","Multiplication","Division",
                               "Exponent","Modulus (Remainder)","Integer division"),
                 Example=c("1+1","5-1","2*5","10/5",
                           "2^3","5%%2","5%/%2"),
                 Results=c(1+1,5-1,2*5,10/5,
                           2^3,5%%2,5%/%2)))
```

## Relational operators

```{r relational,echo=FALSE,eval=TRUE}
kable(data.frame(Operator=c("<", ">", "<=", ">=", "==", "!="),
                 Description=c("Less than","Greater than","Less than or equal","Greater than or equal",
                               "Equal to","Not equal to"),
                 Example=c("1<2","5>4","5<=5","3>=1",
                           "2==2","2!=2"),
                 Results=c(1<2,5>4,5<=5,3>=1,
                           2==2,2!=2)))
```

## Operators and vectors

```{r operatorVector}
x <- 1:5 # vector from 1 to 5
y <- c(2,2,2,2,2) # c for concatenate
x + y
x == y
which(x == y)
```

## Quizz

1. What is the difference between `=` and `==`?

## Built-in functions

```{r example3.1,echo=TRUE,eval=FALSE}
function_name(arg1 = val1, arg2 = val2)
```

```{r example3}
x <- c(1, 2, 3, 6)
sin(x)
seq(1, 10)
sum(x)
```

## Your own functions

Define a function instead of copying and pasting blocks of code.

```{r myFct}
# define a function called addTwo
addTwo <- function(x) {
  return(x + 2)
}
# use the function
addTwo(2)
```

Trick: use tab to complete names

## Your own functions
```{r myFct2}
# definition of a more useful function
fahrenheit_to_celsius <- function(temp_F) {
  temp_C <- (temp_F - 32) * 5 / 9
  return(temp_C)
}
# use it, the name explains what the function does
fahrenheit_to_celsius(32)
```

## Your own functions

```{r myFct3}
# set default values of function parameters
mySum <- function(iOne=1, iTwo = 3){
  return(iOne + iTwo)
}

# use the default parameters
mySum()
```



## Object types

There are different types of objects (variables): numerics, characters, factors, logicals, lists, data.frames. 
Inspect with `class()`.
```{r example4}
x
class(x)
y <- "neuroscience"
class(y)
```

TRICK: Use tab to complete the name of a function in RStudio.

## Data frames

Data are often organized as data frames.

```{r dataFrame1}
# create a data frame
df<-data.frame(firstName=c("Sonia","Bruno","Paul"),
           height=c(170,188,150),
           weight=c(72,90,50),
           married=c(TRUE,FALSE,FALSE))
df
```

Trick: Use `view(df)` to get a more excel-like look.

## Data frames

```{r dataFrame2,echo=FALSE}
df
```

1. Data frames are like tables. 
2. A `row` usually represents one observation (e.g., one subject). 
3. A `column` often contains a variable (e.g., height). 
4. A `cell` contains a single value.

TRICK: Organize your data frame with one entry per row whenever possible. 

## Subsetting data frames

```{r dataFrame3}
# one variable
df$height
# or
df[,"height"]
```

## Subsetting data frames
```{r dataFrame4}
# one row
df[1,]
# two rows
df[c(1,2),]
```

## Subsetting data frames
```{r dataFrame5}
df[df$height>165,]
df[df$weight<80,]
```

What does `df[df$married==TRUE]` do? Is it what you expected?

## Get help

1. A google search: what you want to do + `R` 
2. ?function()
3. Ask someone
4. [Cheat sheets](https://rstudio.com/resources/cheatsheets/)


## R packages

Many useful functions are found in R packages. These are free libraries of functions.

To download and install a package from CRAN (Comprehensive R Archive Network).
```{r install, eval = FALSE}
install.packages("package_name")
```

To load the package in your R session
```{r install1, eval = FALSE}
library("package_name")
```

## Exercise

We will use the mpg data set that comes with tidyverse, so load tidyverse.
You can get information with `?mpg`.

1. What is the mean city miles per gallon of all cars?
2. What is the maximum number of cylinders in the data set?
3. What is the range of the highway miles per gallon in the data? 
4. What is the mean city miles per gallon for the first 20 cars?
5. What is the mean city miles per gallon for vehicles produced in 2008

## Solutions
```{r solution,echo=T,eval=F}
mean(mpg$cty)
max(mpg$cyl)
range(mpg$hwy)
mean(mpg$cty[1:10])
mean(mpg$cty[mpg$year==2008])
```

## An introduction to ggplot2

1. `ggplot2` is an R package for visualization.
2. It is relatively easy to learn.
3. You get nice looking graphs relatively quickly.
4. It works well with data frames.
5. R also has base graphics, `plot()`

## Create a plot

```{r plot}
ggplot(data=mpg) +
  geom_point(mapping = aes(x = displ, y = hwy))
```

## Template

```{r plot1, eval=FALSE}
ggplot(data=<DATA>) +
  <GEOM_FUNCTION>(mapping = aes(<MAPPINGS>))
```

1. `ggplot` creates an empty graph and coordinate system for the data
2. `geom` functions add layers to the plot
3. `geom` functions need a mapping argument paired with `aes()`

## Aesthetic Mapping

Aesthetics include the x-axis and y-axis, together with size, shape, color of the points.

```{r plot2,out.width=500}
ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy, color = class))
```

Shape and color work better with categorical variables.

## Exercise with ggplot2

1. What plot could you produce to investigate whether cars are more efficient on the highway or in a city?
2. How could you add information about the displacement of the motor in your graph? 

## Solution

```{r plot3,out.width=500}
ggplot(data = mpg) +
  geom_point(mapping = aes(x = hwy, y = cty, size=displ),
             color = "blue")+
  xlim(5,40) +
  ylim(5,40)
```

Here I set an aesthetic manually, outside of the `mapping = aes()` block.

## Facets

Split your plot into facets

```{r plot4, out.width=500}
ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_wrap(~class, nrow = 2)
```

## Geometric objects

Show different types of graphs

There are up to 30 types of geoms. 

You can mix geoms.

## Geometric objects

geom_smooth

```{r geom_smooth,out.width=500}
ggplot(data = mpg) +
  geom_smooth(mapping = aes(x = displ, y = hwy))
```

## Geometric objects

geom_smooth

```{r geom_smooth0,out.width=500}
ggplot(data = mpg) +
  geom_smooth(mapping = aes(x = displ, y = hwy, linetype = drv))
```

## Geometric object 

Combining several geoms

```{r geom_smooth1,out.width=400}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
  geom_point() +
  geom_smooth()
```

## Count and distributions

Categorical variable
```{r count,out.width=500}
ggplot(data = mpg) +
  geom_bar(mapping = aes(x=class))
```

## Count and distribution
Continuous variable
```{r count1,out.width=500}
ggplot(data = mpg) +
  geom_histogram(mapping = aes(x=displ))
```

## Exercise 

1. Produce a boxplot showing the highway consumption for the different classes of cars.

## Solution

```{r boxplot, out.width=500}
ggplot(data = mpg) +
  geom_boxplot(mapping = aes(x=class,y=hwy))
```

## Next week
I am in Magdeburg for a collaborative grant application.

Possible workarounds

1. We have slightly longer sessions on the 21st and 28th of November.
2. We find an new date to replace the 7th of November.

## To do before the next lecture

1. Install [git](https://git-scm.com/) on your computer.
2. Reading: R for Data Science, Chapters 1 and 2.


## Next lecture

1. Review exercises
2. Saving you code as .R files.
3. git repositories (create one!)
3. dplyr
4. Example: Analysis of behavioral data
