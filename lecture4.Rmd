---
title: "Data science and analysis in Neuroscience"
author: "Kevin Allen"
date: "December 3, 2019"
output:
  ioslides_presentation: default
  beamer_presentation: default
  slidy_presentation: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
```

## Today's plan

1. Consolidation of dplyr and ggplot
2. git: create your git repository on github
3. Relational data with dplyr

## dplyr and ggplot

Load the tmaze data set for a few more exercises.

```{r load}
myFile="~/repo/dataNeuroCourse/dataSets/tmaze.csv" 
df<-read_csv(myFile)
df<-mutate(df, correct = sample != choice)
```

## git: install 

Make sure you save any R script open in RStudio. 

Install git on your computer

* Windows and Mac: (http://git-scm.com/downloads)
* linux: `sudo apt-get install git-core`

Example for Windows : Download for Windows, Run executable, license next,  default location, will install git bash. Use Git and optional Unix tools from the Windows Command Prompt, 3 x next with default

## Set up RStudio

1. Go to Global Options (from the Tools menu)
2. Click Git/SVN
3. Click Enable version control interface for RStudio projects

For more [information](https://support.rstudio.com/hc/en-us/articles/200532077-Version-Control-with-Git-and-SVN)

## Create a repository on GitHub.

1. Create an account at [GitHub](https://github.com/) and verify your email
2. Log in
3. Click New repository
4. Set repository name: myNotesDataScience, set to private, check Initialize this repository with a README
5. Click Create repository

## Create a project with RStudio from your repository

1. Copy the urs of your repository from the github web site. It ends with `.git`
2. Open RStudio, New Project..., Version Control, Git, 
3. Enter the url and set directory.
4. Create project.

## Your first commit and push
1. Click on commit.
2. Make sure `myNotesDataScience.Rproj` is staged.
3. Set commit message to `my first commit`
4. Click commit
5. Click on the up arrow to push your commit to the online repository.
6. Refresh your web browser to see `myNotesDataScience.Rproj` online.

<!-- ## Set up git for your new repository 
  1. Launch git bash.
2. type `cd` and `enter`
3. type `mkdir repo` to create a directory called `repo` in your home directory.
4. `cd repo`
5. `git config --global user.name "Your name"`
6. `git config --global user.email "youremail@hello.com"`
-->
## Next steps with git...

All you will have to do most of the time.

1. Save the file with your R code in your project directory.
2. Stage the file
3. Commit
4. Push

## Relational data with dplyr

In most project, you need to work with several tables. 

Relations are defined between a pair of tables.

## Relational data with dplyr

Let's assign a genotype to each mouse in a new data frame.

```{r relational1}
dfGeno<-tibble(mouse=c("Mn4656","Mn848","Mn4672","Mn4673",
                           "Mn7712","Mn7735","Mn829"),
           genotype=c("wt","wt","wt","wt",
                      "ko","ko","ko"))
dfGeno
```

***

How is `df` related to `dfGeno`?

```{r relational2}
colnames(df)
colnames(dfGeno)
colnames(dfGeno)[colnames(dfGeno) %in% colnames(df)]
```
`mouse` is a **key**, a variable that connect a pair of tables.

***

* A **primary key** uniquely identifies an observation in its table.

```{r relational3}
dfGeno %>% 
  count(mouse)

```

***

* A **foreign key** uniquely identifies an observation in *another* table.

```{r relational4}
df %>% 
  count(mouse)
```

## Mutating joins

* It first matches observation by their keys.
* Then copies across variables from one table to the other.

```{r relational5}
df<- df %>% 
  left_join(dfGeno,by="mouse") # match with mouse
view(df)
```
We now have an additional variable (genotype) in df.

For more information: [Relational data and dplyr](https://r4ds.had.co.nz/relational-data.html)

## (End - 1)

This is all for today. 

Time to use `git` to `commit` and `push` your changes to your online repository.

